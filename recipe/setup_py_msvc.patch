From 3c2946f7fbc2fd15dd11f4cb5ac22e5c56861e97 Mon Sep 17 00:00:00 2001
From: Ryan Curtin <ryan@ratml.org>
Date: Thu, 27 Oct 2022 17:56:42 -0400
Subject: [PATCH] Try to set MSVC flags more appropriately.

---
 src/mlpack/bindings/python/setup.py.in | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/src/mlpack/bindings/python/setup.py.in b/src/mlpack/bindings/python/setup.py.in
index aabd85a6fb..103ed38106 100644
--- a/src/mlpack/bindings/python/setup.py.in
+++ b/src/mlpack/bindings/python/setup.py.in
@@ -49,16 +49,21 @@ else:
   extra_cxx_flags = re.sub(' +', ' ', cxx_flags)
   cxx_flags += ' '
   cxx_flags += extra_cxx_flags
-  extra_args = ['-DBINDING_TYPE=BINDING_TYPE_PYX', '-std=c++14']
+
+  extra_args = []
+  if platform.system() == 'Windows':
+    # Argument specification is different on MSVC, and also use C++17.
+    extra_args.extend(['/DBINDING_TYPE=BINDING_TYPE_PYX', '/std:c++17', '/MD',
+        '/O2', '/Ob2', '/DNDEBUG'])
+  else:
+    extra_args.append('-DBINDING_TYPE=BINDING_TYPE_PYX')
+    extra_args.append('-std=c++14')
+
   if '${OpenMP_CXX_FLAGS}' != '':
     extra_args.append('${OpenMP_CXX_FLAGS}')
   if cxx_flags:
     extra_args.extend(cxx_flags.split(' '))
 
-  # Extra options for MSVC compiler.
-  if platform.system() == 'Windows':
-    extra_args.extend(['/MD', '/O2', '/Ob2', '/DNDEBUG'])
-
   # This is used for parallel builds; CMake will set PYX_TO_BUILD accordingly.
   if module is not None:
     modules=[\
-- 
2.37.2

