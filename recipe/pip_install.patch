From b58f8b98b3b4dbd20ccff1a9587a457c7ca65e84 Mon Sep 17 00:00:00 2001
From: Ryan Curtin <ryan@ratml.org>
Date: Wed, 9 Nov 2022 13:30:39 -0500
Subject: [PATCH] Use python -m pip install instead of setup.py install.

---
 src/mlpack/bindings/python/PythonInstall.cmake | 15 +++++++++------
 1 file changed, 9 insertions(+), 6 deletions(-)

diff --git a/src/mlpack/bindings/python/PythonInstall.cmake b/src/mlpack/bindings/python/PythonInstall.cmake
index 6e25fb926e..4325011414 100644
--- a/src/mlpack/bindings/python/PythonInstall.cmake
+++ b/src/mlpack/bindings/python/PythonInstall.cmake
@@ -3,15 +3,18 @@
 # A utility script to install Python bindings and fail fatally if installation
 # was not successful.
 if (DEFINED ENV{DESTDIR})
-  execute_process(COMMAND ${PYTHON_EXECUTABLE}
-      "${CMAKE_BINARY_DIR}/src/mlpack/bindings/python/setup.py" install
-          --prefix=${PYTHON_INSTALL_PREFIX} --root=$ENV{DESTDIR}
+  execute_process(COMMAND ${PYTHON_EXECUTABLE} -m pip install
+          --install-option="--prefix=${PYTHON_INSTALL_PREFIX}"
+          --install-option="--root=$ENV{DESTDIR}" .
+      WORKING_DIRECTORY "${CMAKE_BINARY_DIR}/src/mlpack/bindings/python/"
+      RESULT_VARIABLE setup_res)
+elseif (WIN32)
+  execute_process(COMMAND ${PYTHON_EXECUTABLE} -m pip install .
       WORKING_DIRECTORY "${CMAKE_BINARY_DIR}/src/mlpack/bindings/python/"
       RESULT_VARIABLE setup_res)
 else ()
-  execute_process(COMMAND ${PYTHON_EXECUTABLE}
-      "${CMAKE_BINARY_DIR}/src/mlpack/bindings/python/setup.py" install
-          --prefix=${PYTHON_INSTALL_PREFIX}
+  execute_process(COMMAND ${PYTHON_EXECUTABLE} -m pip install
+          --install-option="--prefix=${PYTHON_INSTALL_PREFIX}" .
       WORKING_DIRECTORY "${CMAKE_BINARY_DIR}/src/mlpack/bindings/python/"
       RESULT_VARIABLE setup_res)
 endif ()
-- 
2.38.1

